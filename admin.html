<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin – Handmade By July</title>
    <meta
      name="description"
      content="Private admin area for Handmade By July to add products and fabrics."
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=EB+Garamond:wght@400;500;600&family=Work+Sans:wght@300;400;500;600&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="./styles.css" />
  </head>
  <body>
    <header class="site-header">
      <div class="shell">
        <a href="index.html" class="brand">
          <img
            src="./assets/logo.png"
            alt="Handmade By July logo – hand-painted sun"
            class="brand-logo"
          />
          <div class="brand-text">
            <span class="brand-title">HANDMADE BY JULY</span>
            <span class="brand-tagline">Sunny, soft, handmade pieces</span>
          </div>
        </a>
        <button class="nav-toggle" aria-label="Toggle navigation">
          <span></span><span></span>
        </button>
        <nav class="nav">
          <a href="index.html">Home</a>
          <a href="products.html">Products</a>
          <a href="fabrics.html">Fabrics</a>
          <a href="request.html">Request a piece</a>
        </nav>
      </div>
    </header>

    <main>
      <section class="section page-hero">
        <div class="shell">
          <header class="section-heading">
            <h1 class="page-title">Private admin area</h1>
            <p>
              This page is just for you. Log in with your email and password to
              add new products and fabrics to Handmade By July.
            </p>
          </header>

          <div data-auth-container>
            <form data-login-form class="card" style="max-width: 420px">
              <div class="card-body">
                <h3>Log in</h3>
                <p>
                  Use the email and password you created in Supabase for this
                  website. Once you are logged in, you can go to the Products or
                  Fabrics pages to edit everything directly there.
                </p>
                <label class="label" for="login-email">Email</label>
                <input
                  id="login-email"
                  type="email"
                  required
                  style="margin-bottom: 8px; width: 100%"
                />
                <label class="label" for="login-password">Password</label>
                <input
                  id="login-password"
                  type="password"
                  required
                  style="margin-bottom: 12px; width: 100%"
                />
                <button type="submit" class="btn primary">Log in</button>
                <p
                  data-login-message
                  style="font-size: 13px; margin-top: 8px; color: var(--ink-soft)"
                ></p>
              </div>
            </form>
          </div>
        </div>
      </section>
    </main>

    <footer class="site-footer">
      <div class="shell footer-inner">
        <p>Handmade By July ☀</p>
        <p class="footer-small">
          Handmade with love in New York, with lots of sun.
        </p>
      </div>
    </footer>

    <script src="./script.js"></script>
    <script type="module">
      import { createClient } from "https://esm.sh/@supabase/supabase-js";

      const supabaseUrl = "https://bmzavdormblxxmzeoshi.supabase.co";
      const supabaseAnonKey = "sb_publishable_Wap_flAGqOBtAXZzvi9fYg_Xo96ktf5";
      const supabase = createClient(supabaseUrl, supabaseAnonKey);

      const loginForm = document.querySelector("[data-login-form]");
      const loginMessage = document.querySelector("[data-login-message]");

      function ensureAdminIndicator() {
        if (document.querySelector("[data-admin-indicator]")) return;
        const headerShell = document.querySelector(".site-header .shell");
        if (!headerShell) return;

        const box = document.createElement("div");
        box.className = "admin-indicator";
        box.setAttribute("data-admin-indicator", "true");
        box.textContent = "Logged in as admin";

        const button = document.createElement("button");
        button.type = "button";
        button.textContent = "Log out";
        box.appendChild(button);

        button.addEventListener("click", async () => {
          await supabase.auth.signOut();
          window.location.reload();
        });

        headerShell.appendChild(box);
      }

      async function checkSession() {
        const {
          data: { user },
        } = await supabase.auth.getUser();
        if (user && loginMessage) {
          loginMessage.textContent =
            "You are already logged in. You can go to the Products or Fabrics pages to edit everything.";
          ensureAdminIndicator();
        }
      }

      if (loginForm) {
        loginForm.addEventListener("submit", async (event) => {
          event.preventDefault();
          if (!loginMessage) return;

          loginMessage.textContent = "Signing in…";
          const email = document.getElementById("login-email").value.trim();
          const password = document
            .getElementById("login-password")
            .value.trim();

          const { error } = await supabase.auth.signInWithPassword({
            email,
            password,
          });

          if (error) {
            console.error(error);
            loginMessage.textContent =
              "I could not log you in. Please check your email and password.";
            return;
          }

          loginMessage.textContent =
            "You are now logged in. You can go to the Products or Fabrics pages to edit everything.";
          ensureAdminIndicator();
        });
      }

      checkSession();
    </script>
  </body>
</html>


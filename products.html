<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Products – Handmade By July</title>
    <meta
      name="description"
      content="Browse the handmade products July can sew for you – cases, totes, scrunchies and home pieces."
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=EB+Garamond:wght@400;500;600&family=Work+Sans:wght@300;400;500;600&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="./styles.css" />
  </head>
  <body>
    <header class="site-header">
      <div class="shell">
        <a href="index.html" class="brand">
          <img
            src="./assets/logo.png"
            alt="Handmade By July logo – hand-painted sun"
            class="brand-logo"
          />
          <div class="brand-text">
            <span class="brand-title">HANDMADE BY JULY</span>
            <span class="brand-tagline">Sunny, soft, handmade pieces</span>
          </div>
        </a>
        <button class="nav-toggle" aria-label="Toggle navigation">
          <span></span><span></span>
        </button>
        <nav class="nav">
          <a href="index.html">Home</a>
          <a href="products.html">Products</a>
          <a href="fabrics.html">Fabrics</a>
          <a href="index.html#contact">Contact</a>
        </nav>
      </div>
    </header>

    <main>
      <section class="section page-hero">
        <div class="shell">
          <header class="section-heading">
            <h1 class="page-title">Products I can sew for you</h1>
            <p>
              These are some of the pieces I love making. We can always adjust
              measurements, colors, and fabrics to match your device and style.
            </p>
          </header>

          <div class="grid cards" data-products-grid></div>
        </div>
      </section>
    </main>

    <footer class="site-footer">
      <div class="shell footer-inner">
        <p>Handmade By July ☀</p>
        <p class="footer-small">
          Handmade with love in New York, with lots of sun.
        </p>
      </div>
    </footer>

    <script src="./script.js"></script>
    <script type="module">
      import { createClient } from "https://esm.sh/@supabase/supabase-js";

      const supabaseUrl = "https://bmzavdormblxxmzeoshi.supabase.co";
      const supabaseAnonKey = "sb_publishable_Wap_flAGqOBtAXZzvi9fYg_Xo96ktf5";
      const supabase = createClient(supabaseUrl, supabaseAnonKey);

      const grid = document.querySelector("[data-products-grid]");

      async function loadProducts() {
        if (!grid) return;
        grid.innerHTML = "";

        const { data: products, error } = await supabase
          .from("products")
          .select("*")
          .order("created_at", { ascending: false });

        if (error) {
          console.error("Error loading products", error);
          const message = document.createElement("p");
          message.textContent =
            "I could not load the products right now. Please try again a bit later.";
          grid.appendChild(message);
          return;
        }

        if (!products || products.length === 0) {
          const message = document.createElement("p");
          message.textContent =
            "No products are listed yet. Once I add them here, they will appear on this page.";
          grid.appendChild(message);
          return;
        }

        products.forEach((product) => {
          const article = document.createElement("article");
          article.className = "card";

          const body = document.createElement("div");
          body.className = "card-body";

          const title = document.createElement("h3");
          title.textContent = product.name;

          if (product.short_description) {
            const short = document.createElement("p");
            short.textContent = product.short_description;
            body.appendChild(short);
          }

          if (product.details) {
            const details = document.createElement("p");
            details.textContent = product.details;
            body.appendChild(details);
          }

          if (Array.isArray(product.tags) && product.tags.length > 0) {
            const list = document.createElement("ul");
            list.className = "pill-list";
            product.tags.forEach((tag) => {
              const li = document.createElement("li");
              li.textContent = tag;
              list.appendChild(li);
            });
            body.appendChild(list);
          }

          article.appendChild(body);
          grid.appendChild(article);
        });
      }

      loadProducts();
    </script>
  </body>
</html>

